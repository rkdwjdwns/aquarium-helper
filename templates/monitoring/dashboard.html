{% extends 'base.html' %}

{% block content %}
<div class="text-center mb-16">
    <h1 class="text-4xl font-black text-slate-800 mb-3 tracking-tight">ìŠ¤ë§ˆíŠ¸ ì–´í•­ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
    <p class="text-slate-500 font-medium">ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ë¶€í„° AI ë¦¬í¬íŠ¸ê¹Œì§€ í•œ ë²ˆì— ê´€ë¦¬í•˜ì„¸ìš”.</p>
</div>

<div class="bg-white rounded-[3rem] border border-slate-200 shadow-sm p-10 mb-12 min-h-[350px] flex flex-col justify-center">
    <div class="mb-8 border-b border-slate-50 pb-4">
        <h2 class="text-xl font-black text-slate-800 flex items-center gap-2">
            <span class="text-2xl">ğŸ </span> ë‚´ ì–´í•­ ì‹¤ì‹œê°„ ìƒíƒœ
        </h2>
    </div>

    {% if tank_data %}
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        {% for item in tank_data %}
        <div class="bg-slate-50 border border-slate-100 rounded-[2.5rem] p-8 transition-all hover:shadow-md">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <span class="text-[10px] font-black text-blue-500 uppercase tracking-widest block mb-1">Aquarium Unit</span>
                    <h3 class="text-2xl font-black text-slate-800">{{ item.tank.name }}</h3>
                </div>
                <span class="px-4 py-1.5 rounded-full text-xs font-black 
                    {% if item.status == 'DANGER' %}bg-red-500 text-white animate-pulse
                    {% elif item.status == 'WARNING' %}bg-yellow-400 text-white
                    {% else %}bg-blue-500 text-white{% endif %}">
                    {{ item.status }}
                </span>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-white p-4 rounded-2xl text-center shadow-inner">
                    <p class="text-[9px] text-slate-400 font-black uppercase mb-1">Temperature</p>
                    <p class="text-xl font-black text-slate-800">{{ item.latest.temperature|default:"--" }}Â°C</p>
                </div>
                <div class="bg-white p-4 rounded-2xl text-center shadow-inner">
                    <p class="text-[9px] text-slate-400 font-black uppercase mb-1">pH Level</p>
                    <p class="text-xl font-black text-slate-800">{{ item.latest.ph|default:"--" }}</p>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="controlDevice('{{ item.tank.id }}', 'LIGHT')" 
                    class="flex-1 py-3 rounded-xl text-xs font-black transition-all border-2
                    {% if item.light_on %}bg-yellow-400 border-yellow-400 text-white shadow-lg shadow-yellow-100
                    {% else %}bg-white border-slate-100 text-slate-400{% endif %}">ğŸ’¡ ì¡°ëª…</button>
                <button onclick="controlDevice('{{ item.tank.id }}', 'FILTER')" 
                    class="flex-1 py-3 rounded-xl text-xs font-black transition-all border-2
                    {% if item.filter_on %}bg-blue-500 border-blue-500 text-white shadow-lg shadow-blue-100
                    {% else %}bg-white border-slate-100 text-slate-400{% endif %}">ğŸŒ€ ì—¬ê³¼ê¸°</button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-10">
        <div class="text-6xl mb-6 opacity-20">ğŸŒŠ</div>
        <p class="text-slate-400 font-black text-lg mb-8">ë“±ë¡ëœ ì–´í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        <a href="{% url 'monitoring:add_tank' %}" class="inline-block bg-blue-600 text-white px-10 py-4 rounded-2xl font-black shadow-xl shadow-blue-100 hover:scale-105 active:scale-95 transition-all">
            ì²« ì–´í•­ ë“±ë¡í•˜ëŸ¬ ê°€ê¸°
        </a>
    </div>
    {% endif %}
</div>

<div class="grid grid-cols-2 md:grid-cols-4 gap-6">
    <a href="{% url 'monitoring:dashboard' %}" class="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all text-center group">
        <div class="text-3xl mb-3 group-hover:scale-125 transition-transform">ğŸ“Š</div>
        <p class="font-black text-slate-800">ëŒ€ì‹œë³´ë“œ</p>
        <p class="text-[10px] text-slate-400 font-bold uppercase mt-1">Status</p>
    </a>
    <a href="{% url 'monitoring:camera_view' %}" class="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all text-center group">
        <div class="text-3xl mb-3 group-hover:scale-125 transition-transform">ğŸ“¹</div>
        <p class="font-black text-slate-800">ì¹´ë©”ë¼</p>
        <p class="text-[10px] text-slate-400 font-bold uppercase mt-1">Live Feed</p>
    </a>
    <a href="#" class="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all text-center group">
        <div class="text-3xl mb-3 group-hover:scale-125 transition-transform">ğŸ“</div>
        <p class="font-black text-slate-800">AI ë¦¬í¬íŠ¸</p>
        <p class="text-[10px] text-slate-400 font-bold uppercase mt-1">Analysis</p>
    </a>
    <a href="{% url 'monitoring:logs' %}" class="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all text-center group">
        <div class="text-3xl mb-3 group-hover:scale-125 transition-transform">ğŸ“œ</div>
        <p class="font-black text-slate-800">í™œë™ ë¡œê·¸</p>
        <p class="text-[10px] text-slate-400 font-bold uppercase mt-1">History</p>
    </a>
</div>

<script>
function controlDevice(tankId, deviceType) {
    fetch(`/monitoring/toggle-device/${tankId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: `device_type=${deviceType}`
    })
    .then(res => res.json())
    .then(data => { if(data.status === 'success') location.reload(); });
}
</script>
{% endblock %}
{% extends 'base.html' %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="text-center mb-10">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">π  μ–΄μΆ… νΈν™μ„± μ²΄ν¬</h2>
        <p class="text-gray-500">μƒλ΅μ΄ μ‹κµ¬λ¥Ό λ“¤μ΄κΈ° μ „, AIμ—κ² λ―Έλ¦¬ λ¬Όμ–΄λ³΄μ„Έμ”!</p>
    </div>

    <div class="bg-white p-8 rounded-3xl shadow-xl border border-blue-50">
        <div class="mb-6">
            <label class="block text-sm font-bold text-gray-700 mb-2">ν•¨κ» ν‚¤μΈ μ–΄μΆ…λ“¤</label>
            <input type="text" id="fish-input" placeholder="μ: κµ¬ν”Ό, λ„¤μ¨ν…νΈλΌ, λ² νƒ€" 
                class="w-full px-4 py-3 rounded-xl bg-gray-50 border-none focus:ring-2 focus:ring-blue-400 outline-none transition-all">
        </div>
        
        <button onclick="checkFish()" id="check-btn" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-100">
            νΈν™μ„± λ¶„μ„ μ‹μ‘
        </button>

        <div id="result-area" class="mt-8 hidden animate-fade-in">
            <div class="p-6 rounded-2xl bg-blue-50 border border-blue-100">
                <h4 class="font-bold text-blue-800 mb-2">π“‹ λ¶„μ„ κ²°κ³Ό</h4>
                <div id="ai-response" class="text-gray-700 text-sm leading-relaxed whitespace-pre-wrap">
                    </div>
            </div>
        </div>
    </div>
</div>

<script>
function checkFish() {
    const fishList = document.getElementById('fish-input').value;
    const btn = document.getElementById('check-btn');
    const resultArea = document.getElementById('result-area');
    const responseDiv = document.getElementById('ai-response');

    if(!fishList) return alert("μ–΄μΆ…μ„ μ…λ ¥ν•΄μ£Όμ„Έμ”!");

    // λ΅λ”© μƒνƒ
    btn.disabled = true;
    btn.innerText = "AI λ¶„μ„ μ¤‘...";
    resultArea.classList.add('hidden');

    fetch("{% url 'chatbot:check_compatibility' %}", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: `fish_list=${encodeURIComponent(fishList)}`
    })
    .then(res => res.json())
    .then(data => {
        if(data.status === 'success') {
            responseDiv.innerText = data.result;
            resultArea.classList.remove('hidden');
        } else {
            alert("μ—λ¬: " + data.message);
        }
    })
    .finally(() => {
        btn.disabled = false;
        btn.innerText = "νΈν™μ„± λ¶„μ„ μ‹μ‘";
    });
}
</script>
{% endblock %}